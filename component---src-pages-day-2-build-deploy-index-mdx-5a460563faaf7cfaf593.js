(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{"013z":function(e,t,a){"use strict";a("KKXr"),a("pIFo");var n=a("pOBw"),o=a("q1tI"),r=a.n(o),i=a("NmYn"),l=a.n(i),s=a("OKom"),c=a("k4MR"),p=a("TSYQ"),b=a.n(p),u=a("QH2O"),m=a("qKvR"),h=function(e){var t,a=e.title,n=e.tabs,o=void 0===n?[]:n;return Object(m.b)("div",{className:b()(u.pageHeader,(t={},t[u.withTabs]=o.length,t))},Object(m.b)("div",{className:"bx--grid"},Object(m.b)("div",{className:"bx--row"},Object(m.b)("div",{className:"bx--col-lg-12"},Object(m.b)("h1",{id:"page-title",className:u.text},a)))))},d=a("pEPl"),g=a("BAC9"),O=function(e){var t=e.relativePagePath,a=e.repository,n=d.data.site.siteMetadata.repository,o=a||n,r=o.baseUrl,i=o.subDirectory,l=r+"/edit/"+o.branch+i+"/src/pages"+t;return r?Object(m.b)("div",{className:"bx--row "+g.row},Object(m.b)("div",{className:"bx--col"},Object(m.b)("a",{className:g.link,href:l},"Edit this page on GitHub"))):null},f=a("FCXl"),j=(a("Oyvg"),a("Wbzz")),y=a("I8xM");var w=function(e){var t,a;function n(){return e.apply(this,arguments)||this}return a=e,(t=n).prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a,n.prototype.render=function(){var e=this.props,t=e.tabs,a=e.slug,n=a.split("/").filter(Boolean).slice(-1)[0],o=t.map((function(e){var t,o=l()(e,{lower:!0}),r=o===n,i=new RegExp(n+"(?!-)"),s=a.replace(i,o);return Object(m.b)("li",{key:e,className:b()((t={},t[y.selectedItem]=r,t),y.listItem)},Object(m.b)(j.Link,{className:y.link,to:""+s},e))}));return Object(m.b)("div",{className:y.tabsContainer},Object(m.b)("div",{className:"bx--grid"},Object(m.b)("div",{className:"bx--row"},Object(m.b)("div",{className:"bx--col-lg-12 bx--col-no-gutter"},Object(m.b)("nav",null,Object(m.b)("ul",{className:y.list},o))))))},n}(r.a.Component),N=a("MjG9");t.a=function(e){var t=e.pageContext,a=e.children,o=e.location,r=e.Title,i=t.frontmatter,p=void 0===i?{}:i,b=t.relativePagePath,u=t.titleType,d=p.tabs,g=p.title,j=p.theme,y=p.description,v=p.keywords,C=n.data.site.pathPrefix,P=C?o.pathname.replace(C,""):o.pathname,k=d?P.split("/").filter(Boolean).slice(-1)[0]||l()(d[0],{lower:!0}):"";return Object(m.b)(c.a,{tabs:d,homepage:!1,theme:j,pageTitle:g,pageDescription:y,pageKeywords:v,titleType:u},Object(m.b)(h,{title:r?Object(m.b)(r,null):g,label:"label",tabs:d}),d&&Object(m.b)(w,{slug:P,tabs:d,currentTab:k}),Object(m.b)(N.a,{padded:!0},a,Object(m.b)(O,{relativePagePath:b})),Object(m.b)(f.a,{pageContext:t,location:o,slug:P,tabs:d,currentTab:k}),Object(m.b)(s.a,null))}},TWsP:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return i})),a.d(t,"default",(function(){return c}));a("91GP"),a("rGqo"),a("yt8O"),a("Btvt"),a("RW0V"),a("q1tI");var n=a("7ljp"),o=a("013z");a("qKvR");function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var i={},l={_frontmatter:i},s=o.a;function c(e){var t=e.components,a=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,["components"]);return Object(n.b)(s,r({},l,a,{components:t,mdxType:"MDXLayout"}),Object(n.b)("h1",null,"Build and Deploy"),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Table of Contents")),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#build-overview"}),"Build"),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#role"}),"Assign the role of the user or the group")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#build-app"}),"Build applications using OCP feature"),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#project"}),"Project")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#build-config"}),"New application & BuildConfig")))),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#create"}),"Create an application"),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#template"}),"Provide self service through template")))),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#automation"}),"Use triggers to allow for automation"),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#image-stream"}),"Image stream and image change trigger")))),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#b2m"}),"Build to Manage")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#delete"}),"Delete an application")))),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#deploy-overview"}),"Deploy"),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#rolling"}),"Rolling deployment strategy")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#recreate"}),"Recreate deployment strategy")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#blue-green"}),"Blue-Green deployment strategy")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#canary"}),"Canary release")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#a-b"}),"A/B testing")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#ci-cd"}),"Triggers to support CI-CD")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#operator"}),"Deploy an Operator")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#helm"}),"Deploy an application using the Helm Charts")))),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#implementing"}),"Implementing build and deploy"))),Object(n.b)("a",{name:"build-overview"}),Object(n.b)("h1",null,"Build Overview"),Object(n.b)("p",null,"A build is the process of transforming input parameters into a resulting object. Most often, the process is used to transform input parameters or source code into a runnable image."),Object(n.b)("p",null,"One of the challenges in building an application in a traditional platform is a consistent environment for testing across development, test, pre-production, and production.  With an inconsistent environment, code that passed in the test environment might misbehave in the pre-production environment, for example.  Amongst other benefits, this is what the OpenShift Container Platform (a.k.a. OCP)/Kubernetes platform provides: a consistent platform to build and deploy an application."),Object(n.b)("p",null,"OCP build and deploy process also supports the CI/CD pipeline concept. Central to the OCP/Kubernetes application build and deploy is the use of container images.  Container images include the application, configuration, and runtime dependencies, making it very suitable to create a consistent environment.  The exact same image is run in every environment.  The standard practice is that you do not modify the image upstream. A change in the image done in production will not persist. If a change needs to be made, then it begins in the development environment, and the entire deployment process starts over. This way system stability, and application resiliency are increased.  When failures occur, identifying issues and rolling back to a previous version can be done easily."),Object(n.b)("p",null," OCP 4.x pipeline build strategy is ",Object(n.b)("a",r({parentName:"p"},{href:"https://docs.openshift.com/container-platform/4.3/builds/understanding-image-builds.html#builds-strategy-pipeline-build_understanding-image-builds"}),"based on Tekton"),". If you need Jenkins, OCP also provides Jenkins plugins."),Object(n.b)("p",null," IBM CloudPak for Application add additional  tools such as ",Object(n.b)("a",r({parentName:"p"},{href:"https://developer.ibm.com/technologies/containers/tutorials/knative-build-app-development-with-tekton/"}),"Tekton")," and ",Object(n.b)("a",r({parentName:"p"},{href:"https://developer.ibm.com/open/projects/kabanero"}),"Kabanero"),"."),Object(n.b)("p",null,"Container images have ",Object(n.b)("strong",{parentName:"p"},"image tags")," associated with them when they are built.  When you build a container image, it is by default is tagged as ",Object(n.b)("em",{parentName:"p"},"latest"),"."),Object(n.b)("p",null,"Prior to releasing the application to the production environment, the DevOps Engineer needs to ensure that the application can be monitored and managed.  A recommended practice is to include components in the coding process so that the application can be managed effectively.\nGarage & Solution Engineering (a.k.a. GSE) has released a point of view document on ",Object(n.b)("strong",{parentName:"p"},"Build to Manage")," and will be presented briefly as well."),Object(n.b)("h1",null,"Day 1 Platform"),Object(n.b)("p",null,"Performing a build is mostly an application activity.  While the OCP out-of-the-box installation should install the necessary components to do this,  you need to ",Object(n.b)("strong",{parentName:"p"},"configure the infrastructure for defining the user, group, and permissions")," for the users to perform their build activity.  For example, you need to configure the OCP Clusters to authenticate to the Enterprise LDAP server."),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Day 1 Platform task for Build:")),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Configure the infrastructure for defining the user, group, and permissions     ")),Object(n.b)("h1",null,"Day 2 Platform"),Object(n.b)("p",null,"In Day 1 you configure the platform for defining the user, group, and permissions. On Day 2 you need to assign the permission so that the users are set up correctly to start building the application. For example, if the user and group are defined in the enterprise LDAP, you still need to ",Object(n.b)("a",r({parentName:"p"},{href:"#role"}),"assign the role of the user or the group")," in the OCP Cluster."),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Day 2 Platform task for Build:")),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Assign the role of the user or the group  ")),Object(n.b)("h1",null,"Day 1 Application"),Object(n.b)("p",null,"Depending on the programming language and build methodology that the developers want to use, you need to ",Object(n.b)("strong",{parentName:"p"},"install and configure the development tools")," for the developers to use.  For example, if the developers need to use the IBM Cloud Pak for Application, then you need to deploy the tool and configure it."),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Day 1 Application task for Build:")),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Install and configure the development tools  ")),Object(n.b)("h1",null,"Day 2 Application"),Object(n.b)("p",null,"The following shows the recommendation for Day 2 utilizing the OCP Build capability to support CI/CD:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#build-app"}),"Build applications using OCP feature"),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#project"}),"Project")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#build-config"}),"New application & BuildConfig")))),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#create"}),"Create an application"),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#template"}),"Providing self service through template")))),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#automation"}),"Use triggers to allow for automation"),Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#image-stream"}),"Image stream and image change trigger")))),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#b2m"}),"Build to Manage")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#delete"}),"Delete an application"))),Object(n.b)("h1",null,"Mapping to Personas"),Object(n.b)("p",null,"The following lists the topics that you may want to consider for Day 2 based on the persona:  "),Object(n.b)("table",null,Object(n.b)("thead",{parentName:"table"},Object(n.b)("tr",{parentName:"thead"},Object(n.b)("th",r({parentName:"tr"},{align:null}),"Persona"),Object(n.b)("th",r({parentName:"tr"},{align:null}),"task"))),Object(n.b)("tbody",{parentName:"table"},Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"SRE"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"Assign the role of the user or the group")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"DevOps Engineer"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"Build applications using OCP feature")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"DevOps Engineer"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"Create an application")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"DevOps Engineer, SRE"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"Use trigger to allow for automation")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"DevOps Engineer, SRE"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"Build to Manage")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"DevOps Engineer"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"Deleting an application")))),Object(n.b)("h1",null,"Platform tasks (Build and Deploy)"),Object(n.b)("a",{name:"role"}),Object(n.b)("h2",null,"Assign the role of the user or the group ","[ SRE ]"),Object(n.b)("p",null,"After the OCP is installed, configured, and ready to be used, you need to assign the user or the group to the developer role.  The user and group might be defined and authenticated externally, such as through the enterprise LDAP system. However, your company security policy might necessitate you to set up what they are authorized to do in the OCP cluster when doing a Build and Deploy activity.  Please refer to the ",Object(n.b)("a",r({parentName:"p"},{href:"../UserManagement"}),"User Management")," chapters for setting up User."),Object(n.b)("h1",null,"Application tasks"),Object(n.b)("a",{name:"build-app"}),Object(n.b)("h2",null,"Build applications using OCP feature: ","[ DevOps Engineer]"),Object(n.b)("p",null,"OCP builds additional features on top of what comes standard with Kubernetes.  Kubernetes provides the scalable architecture and OCP provides additional resources for better automation for Build and Deploy activities.  "),Object(n.b)("p",null,"Two of such resources are the ",Object(n.b)("strong",{parentName:"p"},"Project")," and the ",Object(n.b)("strong",{parentName:"p"},"BuildConfig"),".  For OCP environments, the Day 2 recommendation is to make use of these two resources and the additional resources created by these two resources."),Object(n.b)("a",{name:"project"}),Object(n.b)("h3",null,"Project"),Object(n.b)("p",null,"OCP provides the ",Object(n.b)("em",{parentName:"p"},"project")," resource to help a DevOps engineer to build and manage an application."),Object(n.b)("p",null,"A project is a Kubernetes namespace with additional annotations and support from OCP.\nIt is a Kubernetes resource to group together the following object:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"resources"),", such as build config, replication controller, routes, services, etc."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"policies"),": defines the user authorisation against the resources."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"constraints"),": quotas and default resources (cpu, memory) allocation."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"service accounts"),": non-human users accounts that interact with the resources.")),Object(n.b)("p",null,"When users log in to Openshift, either through the web console or through CLI, the first screen or CLI response displays project information. In OCP, a project is important to initiate an application build.  "),Object(n.b)("p",null,"The following shows the CLI’s reponse and the web console of Openshift 3.11 and 4.x that shows that the project is a central resource in an OCP interaction."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),"# oc login -u admin -p 'MySecretPassword'\nLogin successful.\n\nYou don't have any projects. You can try to create a new project, by running\n\n    oc new-project <projectname>\n\n#\n")),Object(n.b)("a",{href:"/assets/img/day2/ocp311_web.png"},Object(n.b)("img",{src:"/assets/img/day2/ocp311_web.png",alt:"OCP 3.x Web Interface showing project",title:"View OCP 3.x Web Interface showing project",width:"500",align:"center"})),Object(n.b)("a",{href:"/assets/img/day2/ocp42_web.png"},Object(n.b)("img",{src:"/assets/img/day2/ocp42_web.png",alt:"OCP 4.x Web Interface showing project",title:"View OCP 4.x Web Interface showing project",width:"500",align:"center"})),Object(n.b)("p",null,"A project is a special template, a facilitator of setting up a self-service Kubernetes environment; and yes, you can modify your template.  You can modify the default project template so that it performs other things in addition to the default tasks.  We will describe the topic of the template as a way to start the build process of an application in the latter part of this chapter."),Object(n.b)("p",null,"One example will be to implement a network policy to close the project build result for external traffic.  Doing this will ensure that any project created in the environment will be isolated and secured.  Please refer to the ",Object(n.b)("a",r({parentName:"p"},{href:"../Network"}),"network chapter")," of this repository for more information on the network resource."),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"A recommendation is to add the quota and limit range resource to your project, so by default, your project is bounded.  If the project needs additional compute or memory, then the DevOps Engineer can modify the generated limit range resource.  Quota and limit range are mentioned in the ",Object(n.b)("a",r({parentName:"p"},{href:"../Capacity"}),"capacity chapter")," of this repository.")),Object(n.b)("a",{name:"build-config"}),Object(n.b)("h3",null,"New application & BuildConfig"),Object(n.b)("p",null,"When you create a new application in a project, OCP can create all the other resources for you."),Object(n.b)("p",null,"The following is an example of the screen to create an application started by clicking a new project button in OCP 4.x web console.  "),Object(n.b)("a",{href:"/assets/img/day2/phpbuild.png"},Object(n.b)("img",{src:"/assets/img/day2/phpbuild.png",alt:"Example of a new project",title:"View example of a new project",width:"500",align:"center"})),Object(n.b)("p",null,"When you create an application in a project, OCP creates the following for you:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"a ",Object(n.b)("strong",{parentName:"li"},"Build Config")),Object(n.b)("li",{parentName:"ul"},"an ",Object(n.b)("strong",{parentName:"li"},"image stream")),Object(n.b)("li",{parentName:"ul"},"a ",Object(n.b)("strong",{parentName:"li"},"deployment config")),Object(n.b)("li",{parentName:"ul"},"a ",Object(n.b)("strong",{parentName:"li"},"service")),Object(n.b)("li",{parentName:"ul"},"a ",Object(n.b)("strong",{parentName:"li"},"route"))),Object(n.b)("p",null,"After deploying the project, OCP will also create a dashboard for the project, as shown below."),Object(n.b)("a",{href:"/assets/img/day2/projstatus1.png"},Object(n.b)("img",{src:"/assets/img/day2/projstatus1.png",alt:"OCP Project Dashboard 1",title:"View OCP Project Dashboard 1",width:"500",align:"center"})),Object(n.b)("a",{href:"/assets/img/day2/projstatus2.png"},Object(n.b)("img",{src:"/assets/img/day2/projstatus2.png",alt:"OCP Project Dashboard 2",title:"View OCP Project Dashboard 2",width:"500",align:"center"})),Object(n.b)("a",{href:"/assets/img/day2/projstatus3.png"},Object(n.b)("img",{src:"/assets/img/day2/projstatus3.png",alt:"OCP Project Dashboard 3",title:"View OCP Project Dashboard 3",width:"500",align:"center"})),Object(n.b)("p",null,"As part of project resource creation, OCP creates the ",Object(n.b)("strong",{parentName:"p"},"build config")," resource automatically.  A Build Config is an OCP’s resources that hold the configuration to perform a build.  It has a build strategy and the  information required to perform the build strategy. The build strategies in OCP includes: Docker build, Source-to-Image (S2I) build, pipeline build, and custom build. More details on BuildConfig can be found in ",Object(n.b)("a",r({parentName:"p"},{href:"https://docs.openshift.com/container-platform/4.3/builds/understanding-buildconfigs.html"}),"OCP Documentation"),"."),Object(n.b)("p",null,"In the Web Console, you can access them through the project resource page, or you can access it through the Build Config page as shown below:"),Object(n.b)("a",{href:"/assets/img/day2/bc0.png"},Object(n.b)("img",{src:"/assets/img/day2/bc0.png",alt:"OCP Build Config",title:"View OCP Build Config",width:"500",align:"center"})),Object(n.b)("p",null,"Clicking one of the build config resource listed will give further detail, as shown below:"),Object(n.b)("a",{href:"/assets/img/day2/bc1.png"},Object(n.b)("img",{src:"/assets/img/day2/bc1.png",alt:"OCP Build Config Resource",title:"View OCP Build Config Resource",width:"500",align:"center"})),Object(n.b)("p",null,"It is worth noting:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"A rebuild operation can be performed by choosing it from the action button."),Object(n.b)("li",{parentName:"ul"},"In this example, the source code is defined in a git repository.  This is a common expectation of a build config to points to a git repository containing the source code.")),Object(n.b)("p",null,"The detail of the build process can be seen through the web console, as shown below."),Object(n.b)("a",{href:"/assets/img/day2/builddetail0.png"},Object(n.b)("img",{src:"/assets/img/day2/builddetail0.png",alt:"OCP Build Detail",title:"View OCP Build Detail",width:"500",align:"center"})),Object(n.b)("a",{href:"/assets/img/day2/builddetail1.png"},Object(n.b)("img",{src:"/assets/img/day2/builddetail1.png",alt:"OCP Build Detail",title:"View OCP Build Detail",width:"500",align:"center"})),Object(n.b)("p",null,"The log of the build process can be seen through the web console, as shown below."),Object(n.b)("a",{href:"/assets/img/day2/builddetail2.png"},Object(n.b)("img",{src:"/assets/img/day2/builddetail2.png",alt:"OCP 4.x Build Config Log",title:"OCP 4.x Build Config Log",width:"500",align:"center"})),Object(n.b)("h3",null,"Build Triggers"),Object(n.b)("p",null,"A build trigger is automation that allows the build to be performed automatically when the underlying source of the build changes.  Based on the source, there are three such build triggers.  One of them is the ",Object(n.b)("em",{parentName:"p"},"config change")," trigger.  A ",Object(n.b)("em",{parentName:"p"},"config change")," trigger is activated when there is a change in the configuration stored in a BuildConfig.  This trigger, if set, will cause the build to be automatically executed on a BuildConfig change. The other two triggers are ",Object(n.b)("em",{parentName:"p"},"webhook trigger")," and ",Object(n.b)("em",{parentName:"p"},"image change")," trigger, which will be covered later in this chapter."),Object(n.b)("a",{name:"create"}),Object(n.b)("h2",null,"Create an application:  ","[ DevOps Engineer ]"),Object(n.b)("p",null,"OCP provides multiple ways to create an application. The following lists some of them:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"From a source code repository using CLI"),Object(n.b)("li",{parentName:"ul"},"From an image using CLI"),Object(n.b)("li",{parentName:"ul"},"From a template using CLI"),Object(n.b)("li",{parentName:"ul"},"Using the Developer Perspective"),Object(n.b)("li",{parentName:"ul"},"Using an Operator")),Object(n.b)("p",null,"As mentioned earlier in this chapter, to take advantage of the facility provided by OCP, it is recommended to select or create the project before you start creating the application using any of the CLIs discussed below."),Object(n.b)("h3",null,"Create an Application from a source code repository using CLI"),Object(n.b)("p",null,"To create an application using a CLI, you use the ",Object(n.b)("inlineCode",{parentName:"p"},"oc new-app")," command.  You can either pass a source code repository, an image, or a template as the argument of the command."),Object(n.b)("p",null,"The following examples show several ways of creating an application using the CLI:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),"01$ oc new-app /<path to source code>\n02$ oc new-app https://github.com/<path to source code>\n03$ oc new-app https://github.com/<path to source code> --source-secret=yoursecret\n04$ oc new-app https://github.com/gitname.git --context-dir=<directory-name>\n05$ oc new-app https://github.com/gitname.git#<branch-name>\n06$ oc new-app /<path to source code> --strategy=docker\n07$ oc new-app openshift/ruby-20-centos7:latest~/<path to source code>\n")),Object(n.b)("p",null,"01 : Using a local source code repository."),Object(n.b)("p",null,"02 : Using source code which resides in a public GitHub repository."),Object(n.b)("p",null,"03 : Using source code which resides in a private private GitHub repository."),Object(n.b)("p",null,"04 : Using source code which resides in a remote GitHub repository with a specific context directory/subdirectory."),Object(n.b)("p",null,"05 : Using source code which resides in a certain branch of a remote git repository."),Object(n.b)("p",null,"06 : The new-app command has an automatic build strategy detection based on the content of your Git repository.  If there is a Jenkinfile in the root directory, then the new-app will use a pipeline strategy.  Use this example to force a specific strategy."),Object(n.b)("p",null,"07 : The new_app command also attempts to automatically detect the programming language being used by the source code. Once the programming language is detected, then the command will attempt to search for a particular imagestream for that language.  Use this example to force a specific imagestream."),Object(n.b)("h3",null,"Create an Application from an image using CLI"),Object(n.b)("p",null,"The same ",Object(n.b)("inlineCode",{parentName:"p"},"oc new-app")," command can be used to create an application using an image.  The image can come from:\n1. a private registry.\n2. an image from DockerHub.\n3. an existing imagestream with an optional tag."),Object(n.b)("p",null,"Examples for each of the image sources are shown below.  The number corresponds to the type listed above."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),"01$ oc new-app myregistry:5000/example/myimage\n02$ oc new-app mysql\n03$ oc new-app image-stream:v1\n")),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"Building an application using community-contributed images such as those that can found in DockerHub is not recommended for security reasons.  There were occurrences where malicious codes were found in these community-contributed images. If you are building an application using an external image, then only use those provided by a known vendor.")),Object(n.b)("h3",null,"Create an Application from a template using CLI"),Object(n.b)("p",null,"An OCP template is a specification of a collection of Kubernetes resources that can be parameterized. A template uses parameters to create Services, Pods, Routers, Build Configurations, and other resources. A template also defines a set of labels to apply to every resource created by the template."),Object(n.b)("p",null,"OCP 3.11 comes out with many templates out of the box. Despite the popularity of the Operator, templates are still useful in OCP 4.x."),Object(n.b)("p",null,"The following shows how you can initialize your project and then creating the application using a template."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),'01$ oc new-project dev-env --display-name="AppName - Dev"\n02$ oc create -f https://<git-address>/ <template-path>/template-name.json -n dev-env\n03$ oc new-app --template="dev-env/template-name"\n')),Object(n.b)("p",null,"The first command create the projec new-project.  "),Object(n.b)("p",null,"The second command imports the template from a git repository to the project.  "),Object(n.b)("p",null,"The third command instantiates the imported template."),Object(n.b)("p",null,"As an example, the following shows an output of a template instantiation.  Some output has been cut out for brevity.  Note that the parameter generated; this is the advantage of using a template.\nAlso, note the last two lines of the output, which describe the GitHub and the Generic triggers.  We will be covering this in the next section on triggers."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),'$ oc new-app --template="dev-env/appname-flask-mongo"\n--\x3e Deploying template "dev-env/appname-flask-mongo" to project dev\n     Flask + MongoDB (Ephemeral)\n     ---------\n     An example Flask application with a MongoDB database. \n     \n     WARNING: MongoDB instance is ephemeral, so any data will be lost \n     on pod destruction.\n\n     The following service(s) have been created in your project:\n     todo-app-flask-mongo, mongodb.\n\n     mongodb Connection Info:\n            Username: userImE             \n            Password: xyz123            \n            Database Name: tododb         \n            Connection URL: mongodb://userImE:mPO37nup@mongodb/appname \n     * With parameters:\n        * Application Name=appname-flask-mongo\n        * Mongodb App=mongodb\n        * Application route=\n        * Git source repository=https://github.com/...\n        * Context Directory=openshift-cicd-flask-mongo\n        * Git branch/tag reference=master\n        * Database name=appname\n        * Database user name=userImE # generated\n        * Database user password=xyz123 # generated\n        * Database admin password=xyzzzz # generated\n        * Memory Limit (Flask)=128Mi  \n        * Memory Limit (MongoDB)=128Mi        \n        * GitHub Trigger=ABC123 # generated\n        * Generic Trigger=TTT123 # generated                     \n')),Object(n.b)("p",null,"The following shows what a template yaml manifest looks like:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),"apiVersion: template.openshift.io/v1\nkind: Template\nlabels:\n  app: appname-example\n  template: appname-example\nmetadata:\n  annotations:\n    description: An example application\n    iconClass: fa fa-leaf\n    openshift.io/display-name: appname Demo App\n    tags: quickstart,appname\n  name: appname-example\nobjects:\n- apiVersion: v1\n  kind: Service\n  metadata:\n    annotations:\n      description: Exposes and load balances the application pods\n    name: appname-example\n  spec:\n    ports:\n    - name: web\n      port: 8080\n      targetPort: 8080\n    selector:\n      name: appname-example\n- apiVersion: v1\n  kind: ImageStream\n  metadata:\n    annotations:\n      description: Keeps track of changes in the application image\n    name: appname-example\n- apiVersion: v1\n  kind: BuildConfig\n  metadata:\n    annotations:\n      description: Defines how to build the application\n    name: appname-example\n  spec:\n    output:\n      to:\n        kind: ImageStreamTag\n        name: appname-example:latest\n    source:\n      contextDir: ${CONTEXT_DIR}\n      git:\n        ref: ${SOURCE_REPOSITORY_REF}\n        uri: ${SOURCE_REPOSITORY_URL}\n      type: Git\n    strategy:\n      sourceStrategy:\n        from:\n          kind: ImageStreamTag\n          name: python:3.6\n          namespace: openshift\n      type: Source\n    triggers:\n    - type: ConfigChange\n    - github:\n        secret: ${GITHUB_WEBHOOK_SECRET}\n      type: GitHub\n- apiVersion: v1\n  kind: DeploymentConfig\n  metadata:\n    annotations:\n      description: Defines how to deploy the application server\n    name: appname-example\n  spec:\n    replicas: 1\n    selector:\n      name: appname-example\n    strategy:\n      type: Rolling\n    template:\n      metadata:\n        labels:\n          name: appname-example\n        name: appname-example\n      spec:\n        containers:\n        - image: appname-example\n          name: appname-example\n          ports:\n          - containerPort: 8080\n          env:\n          - name: APP_VERSION\n            value: v1\n          - name: APP_MESSAGE\n            value: Deployment from Template\n    triggers:\n    - imageChangeParams:\n        automatic: true\n        containerNames:\n        - appname-example\n        from:\n          kind: ImageStreamTag\n          name: appname-example:latest\n      type: ImageChange\n    - type: ConfigChange\nparameters:\n- description: The URL of the repository with your application source code\n  name: SOURCE_REPOSITORY_URL\n  value: https://github.com/githubaccount/gitname.git\n- description: Set this to a branch name, tag or other references of your repository if you\n    are not using the default branch\n  name: SOURCE_REPOSITORY_REF\n- description: Set this to the relative path to your project if it is not in the root\n    of your repository\n  name: CONTEXT_DIR\n- description: Github trigger secret.  A difficult to guess string encoded as part\n    of the webhook URL.  Not encrypted.\n  from: '[a-zA-Z0-9]{40}'\n  generate: expression\n  name: GITHUB_WEBHOOK_SECRET\n")),Object(n.b)("p",null,"More information on using the CLI to create an application can be found in ",Object(n.b)("a",r({parentName:"p"},{href:"https://docs.openshift.com/container-platform/4.3/applications/application-life-cycle-management/odc-creating-applications-using-developer-perspective.html"}),"the Application Life Cycle Management section of the OCP Documentation"),"."),Object(n.b)("a",{name:"developer_console"}),Object(n.b)("h3",null,"Developer perspective"),Object(n.b)("p",null,"The OCP web console provides an option from the ",Object(n.b)("em",{parentName:"p"},"Add view")," to create applications and their associated resources and to deploy them."),Object(n.b)("p",null,"You can create the application from the following sources:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"Git")," this will import an existing codebase in a Git repository."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"Container Image")," will use an existing ",Object(n.b)("em",{parentName:"li"},"image stream"),"."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"Develop Catalog")," will allow the user to select the application in the catalog."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"Dockerfile")," will allow you to import a dockerfile from a Git repository."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"YAML")," will allow you to add a YAML or JSON definition.  ")),Object(n.b)("p",null,"More information on creating an application using the developer perspective User Interface can be found in ",Object(n.b)("a",r({parentName:"p"},{href:"https://docs.openshift.com/container-platform/4.3/applications/application-life-cycle-management/odc-creating-applications-using-developer-perspective.html"}),"the Application Life Cycle Management section of the OCP Documentation"),"."),Object(n.b)("h3",null,"Create an application using an Operator"),Object(n.b)("p",null,"You can create an application from an installed Operator using the OCP web console.  Before you can perform this, your cluster administrator need to download and put the Operator into your cluster first.  "),Object(n.b)("p",null,Object(n.b)("a",r({parentName:"p"},{href:"https://docs.openshift.com/container-platform/4.3/operators/olm-creating-apps-from-installed-operators.html"}),"The OCP Documentation")," also provides you information on creating an application from installed Operators."),Object(n.b)("a",{name:"template"}),Object(n.b)("h3",null,"Provide self service through template"),Object(n.b)("p",null,"You might have a requirement to provide a self-service mechanism for the developer, and yet you want to maintain consistency. Earlier we have discussed about template."),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"One way to configure a self-service mechanism in OCP is by using Templates. ")),Object(n.b)("p",null,"A Template will allow the administrator to specify the application and backend service and how they are configured.  The user, which is a developer, can build and deploy through self-service, this pre-configured application stack, and customized it through the exposed parameters."),Object(n.b)("a",{name:"automation"}),Object(n.b)("h2",null,"Use triggers to allow for automation:  ","[ DevOps Engineer, SRE ]"),Object(n.b)("p",null,"One of the main design focus of a Kubernetes cluster and hence OCP is automation.  For Build and Deploy this automation can be achieved through the use of Build Triggers.  Triggers facilitate the CI/CD practice in OCP."),Object(n.b)("p",null,"We have seen the ",Object(n.b)("em",{parentName:"p"},"config change")," trigger earlier in the chapter.  We will now look at the other two triggers."),Object(n.b)("p",null,"There are two generic ways that applications can communicate with each other: polling and webhooks. The simplified difference is: App A is ",Object(n.b)("em",{parentName:"p"},"polling")," App B by periodically checking App B for the information of interest.  If using ",Object(n.b)("em",{parentName:"p"},"webhooks"),", App B will tell App A on new information."),Object(n.b)("p",null,"Webhooks are automated messages sent from apps when something happens. They have a message or payload and are sent to a unique URL."),Object(n.b)("p",null,"A ",Object(n.b)("em",{parentName:"p"},"webhook trigger")," is an HTTP URL that can be accessed via HTTP POST and includes a token for security. When called, the webhook can trigger new actions such as starting new builds. "),Object(n.b)("p",null,"When you create an application using the ",Object(n.b)("inlineCode",{parentName:"p"},"oc new-app")," command, webhook triggers are generated automatically by OCP. These webhooks can be used by any external system to trigger builds in OCP. "),Object(n.b)("p",null,"Some examples of common systems that are used to trigger OpenShift builds include the following:                                          "),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"GitHub                  "),Object(n.b)("li",{parentName:"ul"},"Configuration-management systems                  "),Object(n.b)("li",{parentName:"ul"},"Ticketing systems                  "),Object(n.b)("li",{parentName:"ul"},"Jenkins")),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"A webhook can only be used with an OpenShift cluster that is visible to the Git repository hosting service. Yes, this is obvious, but sometimes people forget.")),Object(n.b)("p",null,"To determine the URL for the webhook callback, run the ",Object(n.b)("inlineCode",{parentName:"p"},"oc describe")," command on the build configuration:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),"$ oc describe bc/blog\nName:       blog\nNamespace:  myproject\nCreated:    29 hours ago\nLabels:     app=blog\nAnnotations:    openshift.io/generated-by=OpenShiftNewApp\nLatest Version: 1\n\nStrategy:   Source\nURL:        https://github.com/openshift-katacoda/blog-django-py\nFrom Image: ImageStreamTag openshift/python:3.5\nOutput to:  ImageStreamTag blog:latest\n\nBuild Run Policy:   Serial\nTriggered by:       Config, ImageChange\nWebhook GitHub:\n    URL:    https://api.pro-us-east-1.openshift.com:443/oapi/v1/namespaces/\nmyproject/buildconfigs/blog/webhooks/3dhkEZGRlHD18XKbK_0e/github\n\nBuild   Status      Duration    Creation Time\nblog-1  complete    47s         2019-12-23 16:23:47 +1100 AEDT\n\nEvents: <none>\n")),Object(n.b)("p",null,"If you need to regenerate the webhook URL with a new secret token, you can run the command oc set triggers with the build configuration name as an argument, and pass the option ",Object(n.b)("inlineCode",{parentName:"p"},"--from-github"),", ",Object(n.b)("inlineCode",{parentName:"p"},"--from-gitlab"),", or ",Object(n.b)("inlineCode",{parentName:"p"},"--from-bitbucket")," as appropriate. Rerun ",Object(n.b)("inlineCode",{parentName:"p"},"oc describe")," on the build configuration to view the new webhook URL.  "),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),"$ oc set triggers bc <name> --from-github\n")),Object(n.b)("a",{name:"image-stream"}),Object(n.b)("h3",null,"Image stream and image change trigger"),Object(n.b)("p",null,"One of the main reasons for using a container is that their images are immutable.  When you deploy a container now or in a few years, the same container should use the same image defined for that container.  Currently, the most common way of identifying a version of a docker image is through its label, such as ",Object(n.b)("inlineCode",{parentName:"p"},":latest")," or ",Object(n.b)("inlineCode",{parentName:"p"},":1.0"),".  If you use OCP to build and rebuild a codebase, OCP will assign a consistent label assignment.  As you can see later in the deployment section, deploy strategy such as blue-green or Canary may rely on this label.  The issue is you, or somebody else that has the authorization can change or assign any arbitrary label to an image.  If this is done, it can cause to versioning challenge in your environment.   More information ",Object(n.b)("a",r({parentName:"p"},{href:"https://medium.com/@tariq.m.islam/container-deployments-a-lesson-in-deterministic-ops-a4a467b14a03"}),"comparing docker tag and hash")," can be read in this medium’s article. "),Object(n.b)("p",null,"One way that OCP address this challenge is by introducing the resource ",Object(n.b)("strong",{parentName:"p"},"Image Stream"),". An image stream tracks the SHA256 hash of the images it is pointing at. By using an image stream rather than a docker label, OCP ensures when the pods are replicated, they are using the correct binary."),Object(n.b)("p",null,"Another important feature provided by Image Stream is automation, such as providing triggers.  When you use ",Object(n.b)("inlineCode",{parentName:"p"},"oc new_app"),", OCP BuildConfig will use an image stream rather than a regular container registry. "),Object(n.b)("p",null,Object(n.b)("em",{parentName:"p"},"Image change")," triggers allow your build to be automatically invoked when a new version of an upstream image is available. If you are building a Python application, you might use a Python imagestream as the base. If the imagestream trigger is set, then whenever a new version of the Python base image is uploaded to your registry, a new build will be initiated.  "),Object(n.b)("p",null,"You can set the imagestream triggers in the build config using a command as follow:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),"$ oc set triggers bc <app-name> --from-image='<image>'\n")),Object(n.b)("p",null,"Another way to set the image stream trigger is by changing the deployment config using the ",Object(n.b)("inlineCode",{parentName:"p"},"oc patch")," command as follow:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),'$ oc patch dc <app-name> --patch \'{"spec":{"triggers": [{\n                "imageChangeParams": {\n                    "automatic": true,\n                    "containerNames": [\n                        "<app-name-container>"\n                    ],\n                    "from": {\n                        "kind": "ImageStreamTag",\n                        "name": "<ImageStreamTabForAppName",\n                        "namespace": "dev"\n                    }\n                },\n                "type": "ImageChange"\n            }\n        ]\n }}\'\n')),Object(n.b)("a",{name:"b2m"}),Object(n.b)("h2",null,"Build to Manage: ","[ DevOps Engineer, SRE ]"),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Build to Manage")," is a recommended GSE practices.\nIt specifies the practice of activities developers should use in order to instrument the application and provide manageability aspects as part of an application release.\nThe Build to Manage approach includes the following aspects:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"HealthCheck API"),Object(n.b)("li",{parentName:"ul"},"Log Format and Catalog"),Object(n.b)("li",{parentName:"ul"},"Deployment correlation"),Object(n.b)("li",{parentName:"ul"},"Distributed Tracing"),Object(n.b)("li",{parentName:"ul"},"Topology Information"),Object(n.b)("li",{parentName:"ul"},"Event Format and Catalog"),Object(n.b)("li",{parentName:"ul"},"Test Cases and Scripts"),Object(n.b)("li",{parentName:"ul"},"Monitoring Configuration"),Object(n.b)("li",{parentName:"ul"},"Runbooks"),Object(n.b)("li",{parentName:"ul"},"First Failure Data Capture"),Object(n.b)("li",{parentName:"ul"},"Documentation")),Object(n.b)("p",null,"For each of these practices, a description is provided in this ",Object(n.b)("a",r({parentName:"p"},{href:"https://ibm.box.com/s/xihe1wkdhlofpqslpkg8pzu57f5pcmyf"}),"Point of View document"),"."),Object(n.b)("p",null,"GSE has also written ",Object(n.b)("a",r({parentName:"p"},{href:"https://cloudcontent.mybluemix.net/cloud/garage/content/course/csmo-foundations-build-to-manage/csmo-foundations-build-to-manage"}),"a course on build to manage"),".   "),Object(n.b)("a",{name:"delete"}),Object(n.b)("h2",null,"Delete an application: ","[ DevOps Engineer ]"),Object(n.b)("p",null,"An application has a life cycle. It is recommended to delete applications that are no longer being used periodically in a Kubernetes cluster. If other applications no longer use the supporting resources, then they should also be deleted. These might include Project, BuildConfig, ImageStream, Services, RBAC, and Roles."),Object(n.b)("p",null,"You can delete an application by going to the Topology view in the Developer, right-click the application you want to delete, and click Delete Application to delete it."),Object(n.b)("p",null,"More information on deleting an application can be found in ",Object(n.b)("a",r({parentName:"p"},{href:"https://docs.openshift.com/container-platform/4.3/applications/application-life-cycle-management/odc-deleting-applications.html"}),"the Application Life Cycle Management section of the OCP Documentation"),"."),Object(n.b)("a",{name:"deploy-overview"}),Object(n.b)("h1",null,"Deployment overview"),Object(n.b)("p",null,"After you get your Kubernetes up and running, you can deploy your containerized application.  In traditional computing, after you install an application, you might write a startup script to start an application as part of the operating startup sequence.  However, for most applications, there is no consistent way to ensure that the application is always up with the proper scaling (replica).  In Kubernetes, there is a concept of deployment resource."),Object(n.b)("p",null,"To deploy an application in Kubernetes, you create a deployment resource.  The deployment instructs Kubernetes on how to create and update instances of the application.  Kubernetes Deployment Controller, which runs at the master nodes, will schedule the application instances and monitor them and provide a self-healing mechanism.  If the node hosting the instance is down or deleted, then the deployment configuration will start another instance at a different node."),Object(n.b)("p",null,"OCP extends the deployment resource and provides an integrated approach by making deployment as part of the project resource.  When you create an application through a project (see the build section), OCP will create a ",Object(n.b)("strong",{parentName:"p"},"deployment config")," automatically for you.  "),Object(n.b)("p",null,"The DeploymentConfig resource, together with other resources such as the route resource, allows the implementation of modern deployment concepts such as ",Object(n.b)("strong",{parentName:"p"},"rolling deployment"),", ",Object(n.b)("strong",{parentName:"p"},"blue-green deployment"),", ",Object(n.b)("strong",{parentName:"p"},"A/B testing")," and ",Object(n.b)("strong",{parentName:"p"},"Canary releases"),".  "),Object(n.b)("h1",null,"Day 1 Platform"),Object(n.b)("p",null,"The activity for Day 1 platform is the same as ",Object(n.b)("a",r({parentName:"p"},{href:"#day-1-platform"}),"build"),", you need to ",Object(n.b)("strong",{parentName:"p"},"configure the infrastructure for defining the user, group, and permissions"),"."),Object(n.b)("h1",null,"Day 2 Platform"),Object(n.b)("p",null,"The activity for Day 2 platform is the same as ",Object(n.b)("a",r({parentName:"p"},{href:"#day-2-platform"}),"build"),", you need to ",Object(n.b)("strong",{parentName:"p"},"assign the role of the user or the group"),"."),Object(n.b)("h1",null,"Day 1 Application"),Object(n.b)("p",null,"The activity for Day 1 appliation is the same as ",Object(n.b)("a",r({parentName:"p"},{href:"#day-1-application"}),"build"),", you need to ",Object(n.b)("strong",{parentName:"p"},"install and configure the development tools")," for the developer to use."),Object(n.b)("p",null,"The ",Object(n.b)("a",r({parentName:"p"},{href:"#background-information"}),"Background Information")," section describing ",Object(n.b)("strong",{parentName:"p"},"Background info on Kubernetes’ Deployment and OCP’s DeploymentConfig"),"."),Object(n.b)("h1",null,"Day 2 Application"),Object(n.b)("p",null,"This is the focus of the Day 2 application activities for Deploy.  OCP provides several Deployment Strategies.  The following will be discussed here:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#rolling"}),"Rolling deployment strategy")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#recreate"}),"Recreate deployment strategy")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#blue-green"}),"Blue-Green deployment strategy")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#canary"}),"Canary release")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#a-b"}),"A/B testing")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#ci-cd"}),"Triggers to support CI-CD")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#operator"}),"Deploy an Operator")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"#helm"}),"Deploy an application using the Helm Chart"))),Object(n.b)("h1",null,"Mapping to Personas"),Object(n.b)("p",null,"The following table list the personas’ tasks on Day 2 deploy:"),Object(n.b)("table",null,Object(n.b)("thead",{parentName:"table"},Object(n.b)("tr",{parentName:"thead"},Object(n.b)("th",r({parentName:"tr"},{align:null}),"Persona"),Object(n.b)("th",r({parentName:"tr"},{align:null}),"task"))),Object(n.b)("tbody",{parentName:"table"},Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"SRE"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"Assign the role of the user or the group")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"DevOps Engineer, SRE"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"Rolling deployment strategy")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"DevOps Engineer, SRE"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"Recreate deployment strategy")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"DevOps Engineer, SRE"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"Blue-Green deployment strategy")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"DevOps Engineer, SRE"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"Canary release")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"DevOps Engineer, SRE"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"A/B testing")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"DevOps Engineer, SRE"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"Triggers to support CI/CD")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"DevOps Engineer, SRE"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"Deploy an Operator")),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",r({parentName:"tr"},{align:null}),"DevOps Engineer"),Object(n.b)("td",r({parentName:"tr"},{align:null}),"Deploy an application using the Helm Chart")))),Object(n.b)("h2",null,"Background Information"),Object(n.b)("p",null,"A ",Object(n.b)("strong",{parentName:"p"},"deployment")," resource is a Kubernetes resource for deploying an application. OCP supports this deployment resource; however, OCP extends it by introducing a ",Object(n.b)("strong",{parentName:"p"},"DeploymentConfig")," resource.  You can create this resource using a YAML file as normal, if not, OCP will create this resource automatically as part of the new ",Object(n.b)("strong",{parentName:"p"},"project")," creation."),Object(n.b)("p",null,"The following is an example of a DeploymentConfig resource, accessed through the Web User Interface of OCP 4.x:"),Object(n.b)("img",{src:"/assets/img/day2/dc0.png",alt:"OCP 4.2 DeploymentConfig 0"}),Object(n.b)("p",null,"The DeploymentConfig resource contains the following:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"build")," resource to compile the source code and package it into images."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"images")," are pushed to the registry once it is successfully built."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"services")," are created for the front end pods and back end pods such as database pods.  Their assigned ports are listed."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("strong",{parentName:"li"},"routes")," was created to external access to the pods, and the URL to access them is listed.")),Object(n.b)("p",null,Object(n.b)("img",r({parentName:"p"},{src:"/assets/img/day2/dc1.png",alt:"OCP 4.2 DeploymentConfig 1"})),"   "),Object(n.b)("a",{name:"rolling"}),Object(n.b)("h2",null,"Rolling deployment strategy: ","[ DevOps Engineer, SRE ]"),Object(n.b)("p",null,"Rolling deployment strategy is a deployment method that gradually replaces the old version application pods with the newer version.\nThis is the default deployment strategy of a DeploymentConfig resource.  "),Object(n.b)("h4",null,"When to use:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"When you want to minimize downtime performing a pod level version upgrade.")),Object(n.b)("h4",null,"Dependency:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"The application needs to be able to support running the old and new versions at the same without corrupting the data."),Object(n.b)("li",{parentName:"ul"},"The new pods are typically verified through readiness probe before scaling down the old pods.")),Object(n.b)("h4",null,"YAML manifest example:"),Object(n.b)("p",null,"The following is an example of a deploymentconfig YAML manifest."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),'strategy:\n  type: Rolling\n  rollingParams:\n    updatePeriodSeconds: 1 \n    intervalSeconds: 1 \n    timeoutSeconds: 120 \n    maxSurge: "1" \n    maxUnavailable: "0" \n    pre: {} \n    post: {}\n')),Object(n.b)("h4",null,"Key YAML manifest content:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"maxSurge : the maximum number of additional replication count that can exceed the ReplicationController target count.  If your cluster has a challenge in spare resources, then set this value to 0."),Object(n.b)("li",{parentName:"ul"},"maxUnavailable : the maximum number of Unavailable replication count under the ReplicationController target count.  If your want to guarantee that the number of pods will not drop below normal capacity then specify 0.")),Object(n.b)("p",null,"If you want to have the fastest switch over and has plenty of spare resource capacity, then specify a large (between 50% - 10% target pod counts) maxSurge with 0 maxUnavailable."),Object(n.b)("h4",null,"Process:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Executes any pre lifecycle hook."),Object(n.b)("li",{parentName:"ul"},"Scales up the new ReplicationController up to the maxSurge count."),Object(n.b)("li",{parentName:"ul"},"Scales down the old ReplicationController, maintaining the number of pods (old and new) so that the number of the unavailable pods do not go below on the maxUnavailabe count."),Object(n.b)("li",{parentName:"ul"},"Repeats this scaling until the new ReplicationController has reached the desired replica count and the old ReplicationController has been scaled to zero."),Object(n.b)("li",{parentName:"ul"},"Executes any post lifecycle hook.")),Object(n.b)("h4",null,"Example"),Object(n.b)("p",null,"The following shows the example of a Rolling deployment strategy in action.  In this example, the ReplicationController target count is 3. The maxSurge is set to 1, meaning that the number of pods count can go above the target count by 1 (to 4), and pods are never scaled down to go below the target count (3)."),Object(n.b)("img",{src:"/assets/img/day2/deploy_rolling.svg",alt:"Example of a Rolling deployment strategy",title:"Example of a Rolling deployment strategy"}),Object(n.b)("p",null,"For more information please see the ",Object(n.b)("a",r({parentName:"p"},{href:"https://docs.openshift.com/container-platform/4.3/applications/deployments/deployment-strategies.html"}),"OCP 4.x documentation"),"."),Object(n.b)("a",{name:"recreate"}),Object(n.b)("h2",null,"Recreate deployment strategy: ","[ DevOps Engineer, SRE ]"),Object(n.b)("p",null,"The recreate deployment strategy is a simple deployment strategy in which the current version running pods are scaled to 0, followed by the new version are scaled to the target replication count.  Because of this, the Recreate deployment incurs some downtime; however if the application does not support running two versions at the same time, then this is one of the deployment strategies to consider."),Object(n.b)("h4",null,"When to use:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"When you have limited infrastructure resources, and you do not need to provide continuous application availability."),Object(n.b)("li",{parentName:"ul"},"When your application can not run multiple versions at the same time, for example, if you have only one database instance, and you change the backend database schema between versions."),Object(n.b)("li",{parentName:"ul"},"When your application is using a persistent volume that can not be shared by multiple instances of the same application, such as RWO.")),Object(n.b)("h4",null,"Dependency:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"A running OCP instance.")),Object(n.b)("h4",null,"YAML manifest example:"),Object(n.b)("p",null,"The following is an example of a deploymentconfig YAML manifest."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),"strategy:\n  type: Recreate\n  recreateParams: \n    pre: {} \n    mid: {}\n    post: {}\n")),Object(n.b)("h4",null,"Key YAML manifest content:"),Object(n.b)("p",null,"The recreateParams are optional, and the pre, mid, and post are the ",Object(n.b)("strong",{parentName:"p"},"Lifecycle Hook"),"."),Object(n.b)("h4",null,"Process:"),Object(n.b)("p",null,"The following process sequence is executed for recreate deployment strategy:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Any pre lifecycle hook."),Object(n.b)("li",{parentName:"ul"},"Scales down the previous deployment to zero."),Object(n.b)("li",{parentName:"ul"},"Any mid lifecycle hook."),Object(n.b)("li",{parentName:"ul"},"Scales up the new deployment.  During scale-up, if the replica count of the deployment is greater than one, the first replica of the deployment will be validated for readiness before fully scaling up the deployment. If the validation of the first replica fails, the deployment will be considered a failure."),Object(n.b)("li",{parentName:"ul"},"Executes any post lifecycle hook.")),Object(n.b)("h4",null,"Example"),Object(n.b)("p",null,"The YAML construct is similar to the Rolling deployment strategy, change the Rolling section with Recreate section."),Object(n.b)("p",null,"For more information please see the ",Object(n.b)("a",r({parentName:"p"},{href:"https://docs.openshift.com/container-platform/4.3/applications/deployments/deployment-strategies.html#deployments-recreate-strategy_deployment-strategies"}),"OCP 4.x Recreate Deployment Storategy documentation")," and ",Object(n.b)("a",r({parentName:"p"},{href:"https://docs.openshift.com/container-platform/4.3/applications/deployments/deployment-strategies.html#deployments-lifecycle-hooks_deployment-strategies"}),"OCP 4.x LifeCyle Hooks documentation"),"."),Object(n.b)("a",{name:"blue-green"}),Object(n.b)("h2",null,"Blue-Green deployment strategy: ","[ DevOps Engineer, SRE ]"),Object(n.b)("p",null,"Blue-Green deployment strategy is a deployment strategy for releasing your application in a predictable manner with a goal of reducing any downtime associated with a release. It’s a quick way to prime your app before releasing, and also quickly roll back if you find issues."),Object(n.b)("p",null,"In this deployment strategy, you have two identical application stack with the ",Object(n.b)("em",{parentName:"p"},"green")," environment hosting the current production apps.  This is shown in the following figure."),Object(n.b)("img",{src:"/assets/img/day2/deploy_green.svg",alt:"Example of a Green Deployment",title:"Example of a Green Deployment"}),Object(n.b)("p",null,"When you are ready to make a change to the application, let us say from v1 to upgrade it to v2, you’d do so in the ",Object(n.b)("em",{parentName:"p"},"blue environment"),". In that environment, you deploy the new version of the application, run the smoke tests, and any other tests (including those to exercise/prime the OS, cache, CPU, etc.). When things look good, you change the load balancer/reverse proxy/router to point to the blue environment."),Object(n.b)("img",{src:"/assets/img/day2/deploy_blue.svg",alt:"Example of a Blue Deployment",title:"Example of a Blue Deployment"}),Object(n.b)("p",null,"You monitor for any failures or exceptions because of the release. If everything looks good, you can eventually shut down the green environment and use it to stage any new releases. If not, you can quickly rollback to the green environment by pointing the load balancer back."),Object(n.b)("h4",null,"When to use:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"When you want to minimize downtime performing an application-level version upgrade.")),Object(n.b)("h4",null,"Dependency:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"The application needs to be able to support running the green and blue version at the same without corrupting the data."),Object(n.b)("li",{parentName:"ul"},"As there is a duplicates environment, the infrastructure capacity requirement is also double.")),Object(n.b)("h4",null,"YAML manifest example:"),Object(n.b)("p",null,"The following is an example of a route YAML manifest."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),'spec:\n  host: blue_green.this.is.an.example.com\n  port:\n    targetPort: 8080-tcp\n  subdomain: ""\n  to:\n    kind: Service\n    name: green\n    weight: 100\n  wildcardPolicy: None\n')),Object(n.b)("h4",null,"Key YAML manifest content:"),Object(n.b)("p",null,"Assuming that you have defined your service name ",Object(n.b)("em",{parentName:"p"},"blue")," and ",Object(n.b)("em",{parentName:"p"},"green")," respectively, e.g.:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),"$ oc get svc\nNAME    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\nblue    ClusterIP   172.30.209.40   <none>        8080/TCP   72s\ngreen   ClusterIP   172.30.99.182   <none>        8080/TCP   5m28s\n")),Object(n.b)("p",null,"To switch from green to blue, you just need to change the ",Object(n.b)("em",{parentName:"p"},"name")," in the YAML manifest above."),Object(n.b)("h4",null,"Process:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Define the services ",Object(n.b)("em",{parentName:"li"},"green")," and ",Object(n.b)("em",{parentName:"li"},"blue")," (You can name them anything)."),Object(n.b)("li",{parentName:"ul"},"Create the route that points to the old service (e.g., green).  This establishes the green environment."),Object(n.b)("li",{parentName:"ul"},"Develop a new version of the blue environment."),Object(n.b)("li",{parentName:"ul"},"When tested point the route to the new environment (blue)")),Object(n.b)("h4",null,"Example:"),Object(n.b)("p",null,"Given the previous YAML manifest representing the current route named ",Object(n.b)("em",{parentName:"p"},"bluegreen-example")," pointing to green, and the service has been defined as green and blue above, then to change from green to blue, you execute the following command."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),'oc patch route/bluegreen-example -p \'{"spec":{"to":{"name":"blue"}}}\'\n')),Object(n.b)("p",null,"For more information please see the ",Object(n.b)("a",r({parentName:"p"},{href:"https://docs.openshift.com/container-platform/4.3/applications/deployments/route-based-deployment-strategies.html#deployments-blue-green_route-based-deployment-strategies"}),"OCP 4.x documentation"),"."),Object(n.b)("a",{name:"canary"}),Object(n.b)("h2",null,"Canary release: ","[ DevOps Engineer, SRE ]"),Object(n.b)("p",null,"The terms ",Object(n.b)("em",{parentName:"p"},"canary")," comes from an old practice of coal miners. Canary birds were once used in coal mines to alert miners when toxic gases reached dangerous levels. As long as the canary is healthy, the miners knew that the air was free of dangerous gases. If a canary died, then this signaled an immediate action to evacuate."),Object(n.b)("p",null,"Just like canaries that were once used in coal mining, a small set of pods selected for testing act as the canaries and are used to provide an early warning."),Object(n.b)("p",null,"For OCP, one way to deploy canary is to extend the blue-green deployment strategy and make use of an additional YAML clause, the ",Object(n.b)("strong",{parentName:"p"},"weight"),"."),Object(n.b)("h4",null,"When to use:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"When you want to test a new version in the production environment by running it together at the same time with the old version.  As an option, you can introduce a small percentage of the requests to the new version and slowly increase the traffic.")),Object(n.b)("h4",null,"Dependency:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"The application needs to be able to support running the green and blue version at the same without corrupting the data."),Object(n.b)("li",{parentName:"ul"},"As there are duplicate environments, the infrastructure capacity requirement is also double."),Object(n.b)("li",{parentName:"ul"},"You need to consider the long-running transactions in the old environment. When you switch over to new, you have to gracefully handle those outstanding transactions as well as the new ones. You also need to consider if your database backend can support this.")),Object(n.b)("h4",null,"YAML manifest example:"),Object(n.b)("p",null,"The following is an example of a route YAML manifest."),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),'spec:\n  host: canary.this.is.an.example.com\n  port:\n    targetPort: 8080-tcp\n  subdomain: ""\n  to:\n    kind: Service\n    name: oldversion\n    weight: 9\n  alternateBackends:\n  - kind: Service\n    name: newversion\n    weight: 1\n')),Object(n.b)("h4",null,"Key YAML manifest content:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"alternateBackends: this is your new canary version."),Object(n.b)("li",{parentName:"ul"},"weight: the route will assign traffic based on the proportion of these two numbers.  If the weight of the oldversion is 9 and the weight of the newversion is 1, then from 10 requests, the route will direct 9 of them to the oldversion and 1 to the newversion.  The weight specifications do not need to add to 10 or 100. ")),Object(n.b)("p",null,"Assuming that you have defined your service name ",Object(n.b)("em",{parentName:"p"},"oldversion")," and ",Object(n.b)("em",{parentName:"p"},"newversion")," respectively, e.g.:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),"$ oc get svc\nNAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\noldversion   ClusterIP   172.30.209.40   <none>        8080/TCP   72s\nnewversion   ClusterIP   172.30.99.182   <none>        8080/TCP   5m28s\n")),Object(n.b)("p",null,"To assign different traffic percentages from the oldeversion to the newversion you just need to change the two ",Object(n.b)("em",{parentName:"p"},"weight")," values in the YAML manifest above."),Object(n.b)("h4",null,"Process:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Define the services ",Object(n.b)("em",{parentName:"li"},"oldversion")," and ",Object(n.b)("em",{parentName:"li"},"newversion")," (You can name them something else)."),Object(n.b)("li",{parentName:"ul"},"Create the route that points to the oldversion service.  This establishes the initial environment."),Object(n.b)("li",{parentName:"ul"},"Deploy the newversion environment."),Object(n.b)("li",{parentName:"ul"},"Create the route as in the YAML manifest, initially assign a low number for the ",Object(n.b)("em",{parentName:"li"},"newversion")," weight."),Object(n.b)("li",{parentName:"ul"},"When the newversion is verified (functionality, performance etc.), you can increase the weight of the newversion, increasing the proportion of traffic to it to test under heavier traffic."),Object(n.b)("li",{parentName:"ul"},"Once the newversion is considered good to go, reduce the weight of the oldversion to 0, and the environment can then be used to develop the next new version.")),Object(n.b)("h4",null,"Example:"),Object(n.b)("p",null,"To increase the weight of the newversion:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),'oc patch route/canary-example -p \'{"spec":{"alternateBackends":{"weight":"90"}}}\'\n')),Object(n.b)("p",null,"To take out the traffic from the the oldversion:"),Object(n.b)("pre",null,Object(n.b)("code",r({parentName:"pre"},{}),'oc patch route/canary-example -p \'{"spec":{"to":{"weight":"0"}}}\'\n')),Object(n.b)("p",null,"For more information please see the ",Object(n.b)("a",r({parentName:"p"},{href:"https://docs.openshift.com/container-platform/4.3/applications/deployments/deployment-strategies.html#deployments-canary-deployments_deployment-strategies"}),"OCP 4.x documentation"),"."),Object(n.b)("a",{name:"a-b"}),Object(n.b)("h2",null,"A/B testing: ","[ DevOps Engineer, SRE ]"),Object(n.b)("p",null,"As the name implies, A/B testing is used to test the application functionality between different versions (Version A and Version B).  It can get confused easily with Blue-green Deployment.  Blue-green deployment is about releasing new software safely and rolling back predictably. A/B testing is included here, specifically to describe how you might deploy an environment for A/B testing.  "),Object(n.b)("p",null,"A/B testing is about functionality measurement, and it is very important to have ",Object(n.b)("strong",{parentName:"p"},"the measurement infrastructure in place")," before A/B testing can be implemented."),Object(n.b)("h4",null,"When to use:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"When you want to compare the functionality between two (or more) different versions of the Application.")),Object(n.b)("h4",null,"Dependency:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"The measurement (monitoring) component in place already."),Object(n.b)("li",{parentName:"ul"},"The application needs to be able to support running two or more versions at the same without corrupting the data."),Object(n.b)("li",{parentName:"ul"},"As there are duplicate environments, the infrastructure capacity requirement is also double.")),Object(n.b)("h4",null,"YAML manifest example:"),Object(n.b)("p",null,"The YAML construct is similar to Canary.  In making use of the standard OCP feature, you define the A service and the B service, and use the router to direct traffic appropriately.  "),Object(n.b)("h4",null,"Key YAML manifest content:"),Object(n.b)("p",null,"Please refer to the Canary section above."),Object(n.b)("h4",null,"Process:"),Object(n.b)("p",null,"Please refer to the Canary release. In addition to this, though, you have to implement your measurement process as well.  The expected result is a comparison between the two versions."),Object(n.b)("h4",null,"Example:"),Object(n.b)("p",null,"The following is an example of an A/B testing environment infrastructure in OCP.  A common A/B testing usage is to compare the effectiveness between two different User Interface of the same application.  However, as you can see from the example, you can compare the business logic pods keeping everything else the same, or you can compare the database component as well.  "),Object(n.b)("img",{src:"/assets/img/day2/deploy_ab.svg",alt:"Example of AB Testing",title:"Example of AB Testing"}),Object(n.b)("a",{name:"ci-cd"}),Object(n.b)("h2",null,"Triggers to support CI/CD: ","[ DevOps Engineer, SRE ]"),Object(n.b)("p",null,"Continuous Improvement/ Continuous Delivery is a build and deploy activity that can be triggered automatically due to some update in the code or the base image.  This topic is discussed in the build section above."),Object(n.b)("p",null,"The build and deploy trigger can be initiated as a result of any of the following:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Configuration Change."),Object(n.b)("li",{parentName:"ul"},"Image Change."),Object(n.b)("li",{parentName:"ul"},"Webhook activities.")),Object(n.b)("p",null,"Once the build process has been completed, then any of the deployment strategies mentioned earlier can be triggered automatically."),Object(n.b)("a",{name:"operator"}),Object(n.b)("h2",null,"Deploy an Operator: ","[ SRE, DevOps Engineer ]"),Object(n.b)("p",null,"A controller is a crucial concept in Kubernetes.  It is a software loop running on the master nodes.  Its main function is to compare and to take the required action so that the expressed desired state of a Kubernetes resource is achieved.  Examples of the Kubernetes resource include pods, services, configmaps, or PersistentVolume.  "),Object(n.b)("p",null,"An Operator extends this controller concept to application.  An Operator is a software loop running in a pod comparing and taking the necessary action to ensure the expressed desired state of an application is achieved.  Note, compared to a Controller that runs on the master node, a user application operator is running in a pod. Therefore a user application operator is running in a worker node.  To conform to the resource modeling of Kubernetes, the operator configuration is described in a resource, a custom-resource.  That means the application’s configuration is defined using a Custom Resource Definition."),Object(n.b)("p",null,"From a deployment point of view, deploying an Operator means deploying:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"the CRD."),Object(n.b)("li",{parentName:"ul"},"the Operator controller.")),Object(n.b)("p",null,"You can package your application as an Operator, or you can wrap your existing application as an Operator.  One way to do this is to use ",Object(n.b)("a",r({parentName:"p"},{href:"https://github.com/operator-framework"}),"the Operator Framework"),"."),Object(n.b)("p",null,"The framework includes an example of developing and deploying an Operator in ",Object(n.b)("a",r({parentName:"p"},{href:"https://github.com/operator-framework/getting-started"}),"the Operator Framework - getting started")," part."),Object(n.b)("p",null,"It makes use of two components of the framework:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Operator SDK."),Object(n.b)("li",{parentName:"ul"},"Operator Lifecycle Manager.")),Object(n.b)("p",null,"The getting-started pages above provide a step by step instruction on how to develop and deploy an Operator."),Object(n.b)("p",null,"More information on Operator Life Cycle Management can be found in the ",Object(n.b)("a",r({parentName:"p"},{href:"https://github.com/operator-framework/operator-lifecycle-manager"}),"the Operator Lifecycle Manager")," section of the framework."),Object(n.b)("p",null,"Another good section is on testing your Operator, which can be found in the ",Object(n.b)("a",r({parentName:"p"},{href:"https://github.com/operator-framework/community-operators/blob/master/docs/testing-operators.md"}),"Testing your Operator with Operator Framework")," section."),Object(n.b)("p",null,"Once you have developed your Operator, you can share it in the OperatorHub.  The OperatorHub also includes the contribution from Red Hat."),Object(n.b)("p",null,"More information on deploying an application as an Operator from the OperatorHub catalog can be found in ",Object(n.b)("a",r({parentName:"p"},{href:"https://docs.openshift.com/container-platform/4.3/operators/olm-adding-operators-to-cluster.html"}),"How to install an Operator from OperatorHub"),". "),Object(n.b)("p",null,"You can also check our ",Object(n.b)("a",r({parentName:"p"},{href:"../CatalogManagement"}),"Catalog Management")," chapter for more information on OperatorHub."),Object(n.b)("a",{name:"helm"}),Object(n.b)("h2",null,"Deploye an application using the Helm Charts:  ","[ DevOps Engineer ]"),Object(n.b)("p",null,"In addition to deploying the application using the methods above, an application may come packaged in the form of helm charts or Operators."),Object(n.b)("p",null,"There are plenty of IBM’s applications that are packaged to run on Kubernetes that comes in the form of helm charts.\nPlease refer to the following blog on ",Object(n.b)("a",r({parentName:"p"},{href:"https://blog.openshift.com/openshift-4-3-deploy-applications-with-helm-3/"}),"Deploy Applications with Helm 3"),". "),Object(n.b)("p",null,"You can also refer to the official document on ",Object(n.b)("a",r({parentName:"p"},{href:"https://docs.openshift.com/container-platform/4.3/cli_reference/helm_cli/getting-started-with-helm-on-openshift-container-platform.html"}),"Getting started with Helm 3 on OpenShift Container Platform")," as well as our document on\n",Object(n.b)("a",r({parentName:"p"},{href:"../Sup_Helm3"}),"Helm 3 on OpenShift"),"."),Object(n.b)("p",null,"This repository also includes more information on ",Object(n.b)("a",r({parentName:"p"},{href:"../CatalogManagement"}),"the Catalog Management"),"."),Object(n.b)("a",{name:"implementing"}),Object(n.b)("h1",null,"Implementing Build and Deploy"),Object(n.b)("h2",null,"Kubernetes"),Object(n.b)("p",null,"Kubernetes uses the following resources for Day 2 activities:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://Kubernetes.io/docs/concepts/workloads/controllers/deployment/"}),"deployment")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://Kubernetes.io/docs/concepts/workloads/controllers/replicaset/"}),"replicaset"))),Object(n.b)("h2",null,"OpenShift"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://docs.openshift.com/container-platform/4.3/operators/olm-adding-operators-to-cluster.html"}),"How to install an Operator from OperatorHub"))),Object(n.b)("h2",null,"On IBM Cloud"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://cloud.ibm.com/docs/openshift?topic=openshift-openshift_apps"}),"Deploying Applications in an Openshift cluster on IBM Cloud"))),Object(n.b)("h2",null,"With IBM Cloudpak for Applications"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://cloudpak8s.io/mcm/cp4mcm_worked_example/"}),"Application deployment with Multi Cloud Manager")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://www.ibm.com/support/knowledgecenter/SSCSJL_4.x/about-overview.html"}),"IBM Cloudpak for Application")," provides modern deployment tools."),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://developer.ibm.com/technologies/containers/tutorials/knative-build-app-development-with-tekton/"}),"Tekton")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",r({parentName:"li"},{href:"https://developer.ibm.com/open/projects/kabanero"}),"Kabanero"))),Object(n.b)("h2",null,"Other consideration"),Object(n.b)("p",null,"n/a"))}c.isMDXComponent=!0},pEPl:function(e){e.exports=JSON.parse('{"data":{"site":{"siteMetadata":{"repository":{"baseUrl":"https://github.com/ibm-cloud-architecture/cloudpak8s","subDirectory":"/","branch":"master"}}}}}')},pOBw:function(e){e.exports=JSON.parse('{"data":{"site":{"pathPrefix":""}}}')}}]);
//# sourceMappingURL=component---src-pages-day-2-build-deploy-index-mdx-5a460563faaf7cfaf593.js.map